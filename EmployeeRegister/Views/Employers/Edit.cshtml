@model DAL.Models.Employer

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
    
    <div class="form-horizontal">
        <h4>@Model.Name</h4>
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        @Html.HiddenFor(model => model.Id)
        @Html.HiddenFor(model=>model.Deleted)

        <div class="form-group">
            @Html.LabelFor(model => model.Name, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Name, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.Name, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.EmployerId, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.DropDownList("EmployerId", null, "None" ,htmlAttributes: new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.EmployerId, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="Save" class="btn btn-default" />
                @Modal.TriggerButton("Delete", "#deleteConfirmation", "btn-danger","btn-md")
            </div>
        </div>
    </div>
}

<div>
    @{
        var buttons = new List<(string label, string style, string size, string onClick)>();
        buttons.Add(("Yes","btn-warning","btn-md",$"deleteEmployer({@Model.Id})"));
    }
    @Modal.Window("deleteConfirmation", "Delete", $"Please confirm if you would like to delete {Model.Name}.",buttons)


</div>

@* TODO place in separate file because sections dont work with partial views by design *@
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script language="javascript">
        function deleteEmployer(id) {
            var token = $('[name=__RequestVerificationToken]').val();
            $.ajax({
                type: "POST",
                url: '@Url.Action("Delete", "Employers")',
                data: {
                    'id': id,
                    '__RequestVerificationToken': token,
                },
                headers: function() {
                },
                dataType: 'json',
                contentType: 'application/x-www-form-urlencoded; charset=utf-8',
                success:
                    function() {
                        $('#jstree').jstree(true).refresh();
                    }
            });
        };
    </script>
}
